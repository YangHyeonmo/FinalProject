<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OpenBankingMapper">
	<cache />

	<!-- 오픈뱅킹 계좌 등록 -->
	<insert id="InsertOpenBanking" parameterType="OpenBanking">
		INSERT INTO OPENBANKING (
			open_account_no,
			member_id,  
			open_account_pw, 
			open_bank,
			open_balance,
			regdate )
		VALUES ( #{open_account_no}, #{member_id}, #{open_account_pw}, #{open_bank}, #{open_balance}, sysdate )
	</insert>

	<!-- 오픈뱅킹 계좌 삭제 -->
	<delete id="DeleteOpenBanking" parameterType="OpenBanking">
  		DELETE FROM OPENBANKING
  		WHERE 
			 member_id = #{member_id} AND open_account_no = #{open_account_no} AND open_account_pw = #{open_account_pw}
  	</delete>

	<!-- 오픈뱅킹 계좌 조회 -->
	<select id="SelectOpenBanking" parameterType="String" resultType="OpenBanking">
		SELECT
			open_account_no,
			open_bank,
			member_id,
			open_balance,
			regdate
		FROM 
			OPENBANKING
		WHERE 
			member_id = #{member_id}
		ORDER BY
			regdate DESC
	</select>
	<select id="SelectList" parameterType="String" resultType="OpenBanking">
		SELECT
			*
		FROM 
			OPENBANKING
		where member_id=#{member_id}
	</select>

	<!-- 잔액모으기(출금계좌) -->
	<update id="WithdrawOpenBanking" parameterType="HashMap">
		UPDATE 
			OPENBANKING 
		SET 
			open_balance = open_balance - #{money}
		WHERE 
			 member_id = #{member_id} AND open_account_pw = #{open_account_pw}
	</update>

	<!-- 잔액모으기(입금계좌) -->
	<update id="DepositOpenBanking" parameterType="HashMap">
		UPDATE 
			MainAccount 
		SET
			BALANCE = BALANCE + #{total}
		WHERE 
			 member_id = #{member_id} AND account_pw = #{account_pw} AND account_num = #{account_num}
	</update>

	<!-- 거래내역 로그(잔액모으기 내역) -->
	<insert id="WithdrawLog" parameterType="HashMap">
		INSERT INTO INSTANT (
		 	member_id,
			my_account_num,
			collecting_money,
			collecting_day,
			summary,
			memo )
		VALUES ( #{member_id}, #{account_num}, #{money},
				 sysdate, '즉시모으기', '메모' )	
	</insert>

	<!--거래내역 조회 -->
	<select id="SelectWithdrawLog" parameterType="String" resultType="Instant">
		SELECT
			member_id,
			my_account_num,
			collecting_money,
			collecting_day,
			summary,
			memo 
		FROM 
			INSTANT
		WHERE 
			member_id = #{member_id}
		ORDER BY
			collecting_day DESC
	</select>

	<select id="checkaccount" parameterType="String" resultType="String">
		SELECT 
			account_num 
		FROM 
			MainAccount 
		WHERE
			 member_id = #{member_id}
	</select>


	<!--메인페이지 총 잔액 조회-->
	<select id="TotalOpenBalance" parameterType="String" resultType="int">
		SELECT
			nvl(SUM ( open_balance ),0) AS TOTAL
		FROM 
			OPENBANKING
		WHERE 
			member_id = #{member_id}
	</select>

	<!-- 오픈뱅킹 계좌 등록 -->
	<insert id="InsertMainAccount" parameterType="HashMap">
		INSERT INTO MainAccount (
			member_id,
			account_num,
			account_pw,
			balance )
		VALUES ( #{member_id}, #{account_num}, #{account_pw}, #{balance} )
	</insert>

	<select id="CheckOpenAccount" parameterType="String" resultType="String">
		SELECT 
			open_account_no 
		FROM 
			OPENBANKING 
		WHERE
			 member_id = #{member_id}
	</select>
</mapper>