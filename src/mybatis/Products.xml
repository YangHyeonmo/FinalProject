<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Products">
	
	<select id="searchProduct" parameterType="int" resultType="Products"> <!-- 자기가 가입한 상품보기 -->
	select p.member_id as member_id, f.fin_name as fin_name from products p, finance f where  p.fin_no=f.fin_no and p.fin_no=#{fin_no}
	</select>

	<insert id="insertProducts"  parameterType="hashmap" > <!-- 가입 할시 db에 추가 -->
   insert into products(ref_no, fin_no, member_id) values(Pro_seq.NEXTVAL,#{fin_no},#{member_id})
   </insert>
   
	<select id="financeMain" resultType="Products" parameterType = "int"> <!-- 탑 3 정해서 화면에 띄우기 -->
	select * from
	(select rownum as rnum, a.* from
	(select p.fin_no , count(p.fin_no), f.fin_name from products p, finance f where p.fin_no like '${dbno}%' and p.fin_no = f.fin_no
	group by p.fin_no, f.fin_name
	order by count(p.fin_no) desc) a)
	where rnum between 1 and 3
	</select>

	<select id="selectProducts" parameterType="String" resultType="hashmap">
	select member_id, f.fin_name as fin_name from finance f, products p where p.fin_no = f.fin_no and member_id = #{member_id}
	</select>
	
	<insert id="insertAcc" parameterType="Products">
	insert into account(account_no,member_id, account_type, account_num, account_name, account_pw, made_date, account_date, withdraw, deposit, balance, rate)
	values(#{account_no},#{member_id}, #{fin_pro},#{account_num}, #{fin_name}, #{fin_pw}, sysdate, #{account_date} ,0, 0, 0, #{fin_rate})
	</insert>
	
	<select id="selPro" parameterType="int" resultType="Products">
	select * from products where fin_no = #{fin_no}
	</select>

	<select id="getCountAccount" resultType="int">
	select count(*) from account
	</select>
</mapper>