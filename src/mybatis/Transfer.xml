<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Transfer">
	
	
	<select id="getTransListCount" resultType="int"  parameterType="String">
		select COUNT(*) from ${dbname}
	</select>
	
	<select id="getAccountNum" resultType="Account" parameterType="String">
			select * from account
      where (account_num, account_date) in (
      select account_num, max(account_date) max_date from account group by
      account_num) and account_type='입출금' and member_id = #{id}
	</select>
	
	<select id="dateTransList" resultType="Transfer" parameterType="hashMap">
		select * from transfer where TRANSFER_DAY BETWEEN #{select_date} AND
		#{now_date} and (account_no=#{account_no} or transfer_to_account_no=#{account_no})
	</select>
	
	<select id="getMaxNum" resultType="int" parameterType="String">
		select max(transfer_no) from ${dbname}
	</select>
	
	<insert id="insert_Transfer" parameterType="Transfer">
		insert into Transfer(transfer_no,account_no,transfer_to_member_id,transfer_to_account_no,transfer_price,transfer_alias,transfer_day,member_id)
						values(#{num},#{account_no},#{transfer_to_member_id},#{transfer_to_account_no},#{transfer_price},#{transfer_alias},sysdate,#{member_id})
	</insert>
	<insert id="insertTrans_Auto" parameterType="Transfer">
		insert into Transfer_Auto(transfer_no,account_no,transfer_to_member_id,transfer_to_account_no,transfer_price,transfer_alias,transfer_auto_period,
					transfer_auto_period_start,transfer_auto_period_end, member_id) 
					values(#{num},#{account_no},#{transfer_to_member_id},#{transfer_to_account_no},#{transfer_price},#{transfer_alias},
					#{transfer_auto_period},#{transfer_auto_period_start},null,#{member_id})
	</insert>
	<insert id="insertTrans_Res" parameterType="Transfer">
	insert into Transfer_Res(transfer_no,account_no,transfer_to_member_id,transfer_to_account_no,transfer_price,transfer_alias,transfer_res_day,
						transfer_res_state, member_id) 
						values(#{num},#{account_no},#{transfer_to_member_id},#{transfer_to_account_no},#{transfer_price},#{transfer_alias},#{transfer_res_day}
						,#{transfer_res_state},#{member_id})
	</insert>
	<select id="check_account_no" resultType="Account" parameterType="String">
		select * from account where account_num=#{account_no} 
	</select>
	
	<select id="transferDetail" resultType="Transfer" parameterType="hashmap">
		select * from ${dbname} where transfer_no=${transfer_no}
	</select>
	
	<select id="sendMember" resultType="String" parameterType="String">
		select distinct(member_id) from account where account_num=#{account_num}
	</select>
		
	<update id="updateMoney" parameterType="hashmap">
		update account set balance=balance ${operation} ${money} where account_num=#{account_no}
	</update>

	
	
	
</mapper>